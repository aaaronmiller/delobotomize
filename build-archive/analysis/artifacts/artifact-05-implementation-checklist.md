# Artifact #5 - Complete Implementation Checklist (Context Collapse Recovery)

**Source:** ARTIFACTS.md (lines 2381-3285)
**Date:** 2025-10-15 20:30:00 PST
**Version:** 1.0.0
**Tags:** [checklist, implementation, context-recovery, workflow, MIXED-CONTEXT]

---

## Context Classification

**Primary Context:** **MIXED** (Procedure + DataKiln-Specific Content)

**DataKiln-Specific:** Phase 4 fixes (Gemini API, GPT-5, clipboard), Kilo Code Memory Bank
**General Value:** Phase structure, recovery methodology, validation workflow
**Delobotomize Use:** **Phase structure maps directly to our 5-phase design!**

---

## Executive Summary

**What This Is:**
- 6-phase step-by-step recovery procedure (900 lines)
- Complete workflow from backup ‚Üí audit ‚Üí archive ‚Üí validate ‚Üí document
- Integration with Kilo Code Memory Bank (.kilocode/ directory)
- Agentic swarm migration prep (future parallel execution)

**Time Estimates:**
- Phase 0 (Pre-flight): 5 minutes
- Phase 1 (Audit): 10 minutes
- Phase 2 (Archive): 10 minutes (optional)
- Phase 3 (Memory Bank): 15 minutes
- Phase 4 (Fixes): 20 minutes (DataKiln-specific - OMIT)
- Phase 5 (Validation): 10 minutes
- Phase 6 (Future prep): 5 minutes (optional)

**Direct Value for Delobotomize:**
- ‚úÖ Phase structure matches our design
- ‚úÖ Validation workflow is generic
- ‚úÖ Memory Bank concept = our RAG/MCP system
- ‚úÖ Agentic swarm notes = our parallel execution future
- ‚ùå Kilo Code-specific (.kilocode/ paths) - replace with .delobotomize/
- ‚ùå Phase 4 fixes are DataKiln bugs - not applicable

---

## PHASE STRUCTURE ANALYSIS

### Phase 0: Pre-Flight (5 minutes) ‚úÖ GENERIC

**Actions:**
1. Create timestamped backup
2. Verify required tools (Node.js, pnpm, IDE extensions)
3. Create directory structure (audit-reports/, scripts/, docs/)

**Delobotomize Mapping:**
```bash
# Delobotomize equivalent
delobotomize init

# Creates:
.delobotomize/
  audit-reports/
  archive/
  memory/  # RAG/MCP storage
  config.yaml
```

**Generic Value:** ‚úÖ Safety-first approach (backup before changes)

---

### Phase 1: Automated Codebase Audit (10 minutes) ‚úÖ GENERIC

**Actions:**
1. Install codebase-mapper.cjs (Artifact #3)
2. Configure project goals
3. Run automated analysis
4. Review generated reports (summary, detailed, archival plan, dependency graph)

**Delobotomize Mapping:**
```bash
# Our Phase 1: Audit
delobotomize audit

# Uses:
# - src/core/scanner.ts (from Artifact #3)
# - src/core/classifier.ts (pattern matching + LLM intent)
# - Generates reports in .delobotomize/audit-reports/
```

**Generic Value:** ‚úÖ Entire phase is applicable to ANY project

**DataKiln-Specific Elements (REMOVE):**
```javascript
// Lines 2468-2474 - DataKiln project goals
projectGoals: [
  'YouTube video transcript extraction and analysis',
  'Deep research orchestration with Gemini AI',
  'Browser automation via Playwright',
  'Express API server with SSE progress tracking',
  'Frontend UI with Vite/React/Tailwind'
]
```

**Delobotomize Enhancement:**
```javascript
// Auto-infer project goals instead of hardcoding
projectGoals: await inferProjectGoals()
```

---

### Phase 2: Safe Archival (10 minutes) ‚úÖ GENERIC

**Actions:**
1. Final archive review (check archival-plan.md)
2. Execute archive script (generated by codebase-mapper)
3. Post-archive validation (validate-post-archive.cjs - Artifact #4)

**Delobotomize Mapping:**
```bash
# Our Phase 3: Archive (after Triage)
delobotomize archive --plan .delobotomize/archival-plan.json

# Then:
delobotomize validate
```

**Generic Value:** ‚úÖ Entire phase is applicable to ANY project

**Key Pattern:**
```bash
# Archive script uses git mv (not plain mv) - SMART!
git mv suspicious-file.js .delobotomize/archive/suspicious-file.js
git commit -m "Archive suspicious files"
```

---

### Phase 3: Memory Bank Initialization (15 minutes) ‚ö†Ô∏è PARTIALLY GENERIC

**Actions:**
1. Initialize Kilo Code Memory Bank (.kilocode/ directory)
2. Create systemPatterns.md (WORKING vs BROKEN components)
3. Populate from audit reports
4. Update brief.md and roadmap.md
5. Verify Memory Bank active

**DataKiln-Specific Elements:**
- ‚ùå Kilo Code extension integration (.kilocode/ directory)
- ‚ùå Kilo Code chat commands ("initialize memory bank", "update memory bank")

**Generic Concept:** ‚úÖ Persistent memory of what works vs what's broken

**Delobotomize Replacement:**
```bash
# Our Phase 0: RAG/MCP Setup
delobotomize init --memory

# Creates:
.delobotomize/
  memory/
    findings.json        # Audit results
    classifications.json # File classifications
    dependency-graph.json
    vector-db/           # Embeddings for semantic search

# MCP server exposes:
# - getFileContext(path)
# - semanticSearch(query)
# - getWorkingComponents()
# - getBrokenComponents()
```

**Key Template: systemPatterns.md Structure**

This is VALUABLE - adapt for Delobotomize:

```markdown
# System Patterns & Component Registry

## ‚ö†Ô∏è WORKING COMPONENTS - DO NOT MODIFY

### server.cjs::Backend Line Buffering (Lines 71-82)
- **Status:** ‚úÖ VERIFIED WORKING
- **Function:** Prevents partial JSON parse errors in SSE streaming
- **Why It Works:** Proper stdoutBuffer with lines.pop() pattern
- **Last Verified:** [DATE]
- **Protection Level:** CRITICAL
- **Dependencies:** Express server, child process stdout parsing

---

## üîç BROKEN COMPONENTS - NEEDS FIXING

### deep-research-orchestrator.cjs::splitQuery()
- **Problem:** Uses wrong API format for Gemini
- **Specific Issue:** Uses OpenAI-style `response_format` with Gemini endpoint
- **Impact:** Query splitting phase fails immediately
- **Priority:** P0 - Blocks entire workflow
- **Verification Needed:** Test Gemini API endpoint
- **Fallback:** OpenRouter with gpt-4o-mini

---

## üîå API VERIFICATION STATUS

### Gemini API
- **Endpoint:** https://generativelanguage.googleapis.com/v1beta/openai/
- **Model Used:** gemini-2.0-flash-exp
- **Parameter Format:** ‚ùå UNVERIFIED
- **Status:** üö® NEEDS TESTING BEFORE PRODUCTION
- **Fallback:** ‚úÖ CONFIGURED

---

## üèóÔ∏è ARCHITECTURAL DECISIONS

### Decision: Dual Frontend Architecture (Vite Dev + Express Prod)
- **Rationale:** Fast HMR in dev, single-server simplicity in prod
- **Trade-off:** Two different serving mechanisms
- **Status:** ‚úÖ WORKING but adds complexity

---

## üìÅ FILE SYSTEM DEPENDENCIES

### Base Output Path
- **Path:** /Users/macuser/Documents/ChetasVault/Agent output/
- **Status:** ‚ùå HARDCODED - Not cross-platform
- **Priority:** P2
- **Solution Needed:** Environment variable + directory creation script

---

## üìù RECENT CHANGES LOG

### 2025-10-15: Fixed missing timestamp variable
- **File:** scripts/deep-research-orchestrator.cjs
- **Change:** Added `const timestamp = Date.now()` at line 119
- **Reason:** Variable was referenced but never defined
- **Status:** ‚úÖ VERIFIED WORKING
- **Side Effects:** None

---

## üîÑ MAINTENANCE PROTOCOL

### When to Update This Document
- After fixing any component (move from BROKEN to WORKING)
- After discovering new broken components
- After verifying API endpoints
- After making architectural decisions

---

## üö® CRITICAL REMINDERS FOR AI ASSISTANTS

When asked to fix bugs:
1. **READ THIS ENTIRE FILE FIRST**
2. **CHECK WORKING COMPONENTS** - Never modify components marked ‚ö†Ô∏è
3. **VERIFY API USAGE** - Don't assume API behavior
4. **MAKE SURGICAL CHANGES** - Modify only broken component
5. **UPDATE THIS FILE** - Add entry to RECENT CHANGES LOG
```

**Delobotomize Adaptation:**
```yaml
# .delobotomize/memory/system-patterns.yaml

working_components:
  - path: src/server.js
    lines: "71-82"
    function: "Backend line buffering"
    status: VERIFIED_WORKING
    protection_level: CRITICAL
    last_verified: "2025-10-18"
    why_it_works: "Proper stdoutBuffer with lines.pop() pattern"
    dependencies:
      - Express server
      - child process stdout parsing

broken_components:
  - path: src/api-client.js
    function: "splitQuery()"
    problem: "Uses wrong API format for Gemini"
    specific_issue: "Uses OpenAI-style response_format"
    impact: "Query splitting fails immediately"
    priority: P0
    fallback: "OpenRouter with gpt-4o-mini"

api_verification:
  gemini:
    endpoint: "https://generativelanguage.googleapis.com/v1beta/openai/"
    model: "gemini-2.0-flash-exp"
    status: UNVERIFIED
    needs_testing: true

architectural_decisions:
  - decision: "Dual frontend architecture"
    rationale: "Fast HMR in dev, simplicity in prod"
    tradeoff: "Two serving mechanisms to maintain"
    status: WORKING
    complexity: HIGH

filesystem_dependencies:
  - path: "/Users/macuser/Documents/output/"
    status: HARDCODED
    issue: "Not cross-platform"
    priority: P2
    solution: "Use environment variable"

recent_changes:
  - date: "2025-10-15"
    file: "src/orchestrator.js"
    change: "Added timestamp variable"
    reason: "Referenced but undefined"
    status: VERIFIED_WORKING
    side_effects: NONE
```

---

### Phase 4: Critical Fixes (20 minutes) ‚ùå DATAKILN-SPECIFIC (OMIT)

**Actions in Original:**
1. Fix Gemini API format (response_format ‚Üí generationConfig)
2. Fix GPT-5 model name (doesn't exist ‚Üí gpt-4o)
3. Fix extraction priority (clipboard ‚Üí DOM)
4. Update Memory Bank after fixes

**Why This is DataKiln-Specific:**
- These are bugs in DataKiln's YouTube Research System
- Not applicable to generic projects
- However, the METHODOLOGY is valuable:
  - Identify broken components from Memory Bank
  - Fix ONLY the specific broken component
  - Don't touch working components
  - Verify fix before moving on
  - Update Memory Bank after successful fix

**Delobotomize Equivalent:**
```bash
# Our Phase 4: Remediate
delobotomize remediate --interactive

# Process:
# 1. Load broken components from .delobotomize/memory/
# 2. For each component:
#    - Show problem description
#    - Show recommended fix
#    - Ask user to confirm
#    - Apply fix
#    - Run validation
#    - Update memory if successful
```

---

### Phase 5: Validation & Documentation (10 minutes) ‚úÖ GENERIC

**Actions:**
1. Test critical path (run specific functions)
2. Generate final summary
3. Create emergency recovery checklist

**Delobotomize Mapping:**
```bash
# Our Phase 5: Validate
delobotomize validate --full

# Runs:
# - Import resolution tests
# - Build process tests
# - Server startup tests (if applicable)
# - Custom validation rules from config
```

**Generic Templates:**

**Template 1: Emergency Recovery Checklist**
```markdown
# Emergency Context Recovery

If model starts making blind changes again:

1. Close current conversation
2. Start NEW conversation
3. Load Memory Bank context
4. Confirm you see [Memory Bank: Active]
5. State your bug clearly
6. Ask: "Before suggesting fixes, what components are marked DO NOT MODIFY?"
7. Verify AI reads system patterns before proposing changes

## Circuit Breaker

If AI still goes blind after loading Memory Bank:

Run full audit again:
\`\`\`bash
delobotomize audit
# Review .delobotomize/audit-reports/summary.md
# Check if new out-of-scope files appeared
\`\`\`

Then reload Memory Bank and try again.
```

---

### Phase 6: Future Migration Prep (5 minutes) ‚úÖ GENERIC CONCEPT

**Actions:**
1. Document async-ready tasks
2. Create agentic migration plan

**Content:**
- **Current:** Sequential execution (45 min for 9 queries)
- **Agentic:** Parallel execution (15 min for 9 queries)
- **Speedup:** 3-5x

**Architecture Example (from artifact):**
```
Coordinator Agent
‚îú‚îÄ> Query Split Agent (Gemini API)
‚îú‚îÄ> Research Agent Pool (3-9 instances)
‚îÇ   ‚îú‚îÄ> Browser Agent 1 (query 1-3)
‚îÇ   ‚îú‚îÄ> Browser Agent 2 (query 4-6)
‚îÇ   ‚îî‚îÄ> Browser Agent 3 (query 7-9)
‚îî‚îÄ> Consolidation Agent (GPT-4o)
```

**Delobotomize Relevance:** ‚úÖ Matches our future parallel audit design

**Future Delobotomize:**
```yaml
# .delobotomize/agentic-config.yaml

agents:
  coordinator:
    role: "Orchestrate audit phases"

  file_scanner:
    role: "Scan filesystem"
    concurrency: 1

  import_analyzer_pool:
    role: "Analyze imports/exports"
    concurrency: 10  # Analyze 10 files in parallel
    instances: 10

  intent_classifier_pool:
    role: "LLM-based intent detection"
    concurrency: 5   # API rate limits
    instances: 5

  report_generator:
    role: "Generate markdown reports"
    concurrency: 1
```

---

## KEY LEARNINGS FROM ARTIFACT

### What Went Wrong in DataKiln (General Lessons):
1. ‚ùå No architectural decision records (ADR)
2. ‚ùå API endpoints assumed without testing
3. ‚ùå Experimental models used in production
4. ‚ùå No component status tracking
5. ‚ùå Context collapse during debugging (blind gardener problem)

### Prevention System Installed:
1. ‚úÖ **systemPatterns.md** = Source of truth for what works/breaks
2. ‚úÖ **Automated audit** = Detect scope creep early
3. ‚úÖ **Memory Bank** = Prevent context collapse
4. ‚úÖ **Validation scripts** = Verify changes don't break system
5. ‚úÖ **Emergency recovery** = Quick restoration protocol

---

## DELOBOTOMIZE INTEGRATION

### Phase Mapping:

| DataKiln Phase | Delobotomize Phase | Adaptation Needed |
|----------------|-------------------|-------------------|
| 0: Pre-Flight | 0: Init | Replace .kilocode/ with .delobotomize/ |
| 1: Audit | 1: Audit | Use Artifacts #3 scanner |
| 2: Archive | 3: Archive | Use Artifacts #4 validator |
| 3: Memory Bank | 0: Init (RAG/MCP) | Replace Kilo Code with MCP server |
| 4: Fixes | 4: Remediate | OMIT DataKiln bugs, keep methodology |
| 5: Validation | 5: Validate | Use Artifact #4 validator |
| 6: Agentic Prep | Future | Document for parallel execution |

### What to Keep:
1. ‚úÖ Phase structure (0-6)
2. ‚úÖ systemPatterns.md template (adapt to YAML)
3. ‚úÖ Validation workflow
4. ‚úÖ Emergency recovery checklist
5. ‚úÖ Agentic migration notes

### What to Remove:
1. ‚ùå Kilo Code-specific commands
2. ‚ùå .kilocode/ directory paths
3. ‚ùå Phase 4 DataKiln bug fixes
4. ‚ùå DataKiln project goals

### What to Add:
1. ‚ûï Generic RAG/MCP instead of Kilo Code
2. ‚ûï Auto-inferred project goals
3. ‚ûï Multi-language support
4. ‚ûï Configurable validation rules

---

## TEMPLATES FOR DELOBOTOMIZE

### Template 1: Workflow Script
```bash
#!/bin/bash
# delobotomize-workflow.sh - Complete recovery procedure

echo "Phase 0: Pre-Flight"
delobotomize init
delobotomize backup

echo "Phase 1: Audit"
delobotomize audit

echo "Phase 2: Triage (interactive)"
delobotomize triage

echo "Phase 3: Archive"
delobotomize archive --plan .delobotomize/triage-plan.json

echo "Phase 4: Remediate (interactive)"
delobotomize remediate

echo "Phase 5: Validate"
delobotomize validate --full

echo "‚úÖ Recovery complete!"
```

---

### Template 2: systemPatterns.yaml
```yaml
# .delobotomize/memory/system-patterns.yaml

metadata:
  last_updated: "2025-10-18"
  project_type: "nodejs"
  framework: "express"

working_components:
  - path: "src/server.js"
    lines: "71-82"
    function: "Backend line buffering"
    status: "VERIFIED_WORKING"
    protection_level: "CRITICAL"
    last_verified: "2025-10-18"
    reason: "Prevents partial JSON parse errors"
    dependencies:
      - "express"
      - "child_process"

broken_components:
  - path: "src/api-client.js"
    function: "callAPI()"
    problem: "Uses wrong parameter format"
    priority: "P0"
    impact: "API calls fail immediately"
    recommended_fix: "Use correct parameter format per API docs"

recent_changes:
  - date: "2025-10-18"
    file: "src/utils.js"
    change: "Added validation function"
    reason: "Prevent invalid inputs"
    status: "VERIFIED_WORKING"
```

---

### Template 3: Emergency Recovery
```markdown
# .delobotomize/EMERGENCY_RECOVERY.md

## When Model Goes Blind

If AI starts making random changes without understanding context:

1. **Stop immediately** - Don't let it continue
2. **Load memory** - Run: `delobotomize memory load`
3. **Review system patterns** - Check .delobotomize/memory/system-patterns.yaml
4. **State problem clearly** - Don't assume AI remembers
5. **Verify AI reads patterns** - Ask: "What components should NOT be modified?"

## Circuit Breaker

If AI still acts blind after loading memory:

\`\`\`bash
# Re-run full audit
delobotomize audit

# Review findings
cat .delobotomize/audit-reports/summary.md

# Check for scope creep
cat .delobotomize/audit-reports/suspicious-files.md
\`\`\`

## Rollback

If AI already broke something:

\`\`\`bash
# Restore from backup
delobotomize restore --timestamp [TIMESTAMP]

# Or restore from git
git reset --hard [COMMIT]
\`\`\`
```

---

## RAG/MCP CHUNKING STRATEGY

```json
{
  "chunks": [
    {
      "id": "recovery-phase-structure",
      "content": "6-phase recovery: Pre-flight ‚Üí Audit ‚Üí Archive ‚Üí Memory ‚Üí Fix ‚Üí Validate",
      "metadata": {
        "artifact": "artifact-05",
        "type": "METHODOLOGY",
        "applicable_to": "ANY_PROJECT"
      }
    },
    {
      "id": "system-patterns-template",
      "content": "Template for tracking WORKING vs BROKEN components",
      "metadata": {
        "artifact": "artifact-05",
        "type": "TEMPLATE",
        "file_format": "markdown",
        "delobotomize_adaptation": "Convert to YAML"
      }
    },
    {
      "id": "memory-bank-concept",
      "content": "Persistent memory prevents context collapse during debugging",
      "metadata": {
        "artifact": "artifact-05",
        "type": "CONCEPT",
        "delobotomize_equivalent": "RAG/MCP system"
      }
    },
    {
      "id": "agentic-migration-plan",
      "content": "Future parallel execution for 3-5x speedup",
      "metadata": {
        "artifact": "artifact-05",
        "type": "FUTURE_WORK",
        "speedup": "3-5x"
      }
    }
  ]
}
```

---

## KEY TAKEAWAYS

### What to Keep (60% of content):
1. ‚úÖ **Phase structure** - Maps perfectly to Delobotomize
2. ‚úÖ **systemPatterns.md template** - Adapt to YAML
3. ‚úÖ **Validation workflow** - Generic methodology
4. ‚úÖ **Emergency recovery** - Circuit breaker pattern
5. ‚úÖ **Agentic notes** - Parallel execution future

### What to Remove (30% of content):
1. ‚ùå Kilo Code-specific commands
2. ‚ùå .kilocode/ directory paths
3. ‚ùå Phase 4 DataKiln bug fixes (Gemini API, GPT-5, clipboard)
4. ‚ùå DataKiln project goals

### What to Add (10% new):
1. ‚ûï Generic RAG/MCP instead of Kilo Code
2. ‚ûï Auto-detection instead of hardcoded configs
3. ‚ûï Multi-language support
4. ‚ûï Configurable workflows

---

## NEXT STEPS

1. Extract Artifact #6 (Project Codification) - likely duplicate of #5
2. Update ARTIFACTS_ASSESSMENT_TRACKER.md
3. Create integration plan for all 6 artifacts
4. Map to REVISED_ARCHITECTURE.md phases

---

*End of Artifact #5 Analysis*
*Key Takeaway: Phase structure is GOLD - systemPatterns.md template is ESSENTIAL*
*Next: Artifact #6 (may be duplicate - verify)*
